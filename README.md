# Суть и правила игры

## Общая концпеция

Игра происходит между некоторым количеством игроков на случайно сгенерированной карте. Карта - таблица из `height * width` клеток. Каждая клетка может принадлежать одному из игроков
или не принадлежать никому вовсе. 

Задача игроков - по очереди (пошагово) перемещать свои войска из клетки в клетку, возводить постройки и стать победителем, уничтожив других игроков.

В качестве игроков выступают написанные пользователями боты. **ПОКА ПОДДЕРЖИВАЮТСЯ ТОЛЬКО БОТЫ НА ЯЗЫКЕ С++**.

## Карта и игроки

Пусть в игре `n` игроков. Тогда в игре будет существовать `n + 1` фракция. По одной на каждого игрока + одна фракция нейтралов.

У каждой клетки есть тип - 
* Действующая столица
* Захваченная столица (изначальный владелец столицы не совпадает с текущим) 
* Город
* Гора
* Равнина

Изначально каждому игроку принадлежит ровно одна клетка где-то на поле.
Это его столица.

Также в клетках может стоять некоторое количество войск.
На клетке горы войска распологаться _не могут_.
Изначально в столице расположено 100 солдатов.
На одной клетке не может находиться армия двух фракций одновременно. 
Если на клетке есть солдаты, она принадлежит той фракции, чьи солдаты на ней стоят. Иначе клетка нейтральная.

### Рост войск
Теперь механика появления новых войск. Раз в 25 тактов (см. дальше) на каждой клетке игрока растет население и кол-во его армии на этой клетке растет на 1. Также каждый такт на каждой принадлежащей ему клетке являющейся городом или чьей-то столицей, появляется одна единица войск.
Это верно в случае, если игроку принадлежит его собственная столица. Если игрок теряет свою столицу, его прирост базового населения выключается, а города и столицы начинают приносить войска только раз в 3 такта.

## Действия игроков

Игроки ходят по очереди, в порядке, определенном заранее.
За свой ход игрок может совершить одно из действий, приведенных ниже. Также игроки могут пропустить ход. Когда все живые игроки, начиная с первого и заканчивая последним, сделали ход, считается пройденным очередной игровой **такт**.

### Движение 

Игроки могут передвигать любое натуральное количество войск из клетки в соседнюю по стороне клетку.
_Игрок может передвинуть все войска, находящиеся в некоторой ему принадлежашщей клетке_. 
После этого клетка становится нейтральной.

В случае, если целевая клетка принадлежала фракции, отличной от фракции игрока, происходит схватка.
Обозначим за `a` силы атакующей фракции - кол-во передвигаемых войск, а за `b` силы защищающейся - кол-во войск в целевой клетке, помноженное на модификаторы клетки (см. дальше).

1. Если `a > b`, то атака считается успешной и клетка переходит к атакующему игроку. Войска, защищавшие клетку полностью уничтожаются, а доля потерь атакующих войск в этом случае равна `b / a`.
3. Если `a <= b`, то атака провалена, клетка остается у прежнего владельца либо становится нейтральной, атакующие войска полностью уничтожаются. Доля потерь обороны равна числу `a / b`.

Если после подсчета потерь оставшиеся войска становятся нецелыми, то количество войск округляется вниз.

Если в какой то момент игроку не принадлежит ни одна клетка игрового поля, он выбывает. _Обратите внимание_, что перемещение войск считается мгновенным. То есть переместив все войска из своей единственной клетки, игрок **не** выбывает.

### Строительство

Также игроки имеют возможность строить различные конструкции. Для строительства выбираются соседние по стороне или совпадающие целевая клетка и начальная. Они должны принадлежать игроку, занимающемуся строительством. С
тоимость строительства вычитается из войск начальной клетки. Пока для строительства доступны 2 вида зданий:
1. Стена. Изначальная стоимость - 50 войск. Увеличивает оборонительную мощь войск в клетке на 30%. Прирост стоимости составляет 10% за одну постройку.
2. Город. Изначальная стоимость - 200 войск. Делает тип целевой клетки городом. Целевая клетка должна являться равниной. Прирост стоимости составляет 70% за одну постройку.

**ПОСТРОЙКИ ЕЩЕ НЕ ПРОТЕСТИРОВАНЫ**

## Обзор

Игроки видят только те клетки игрового поля, которые находятся рядом с их территорией. Все остальные клетки скрыты туманом войны.

### Доступная информация о клетках
Про клетки в тумане войны игрок знает исключительно то, является ли клетка равниной. 

Про видимые клетки игроку известна следующая информация:
1. Кол-во войск в клетке.
2. Владелец клетки.
3. Тип клетки и все постройки на ней.
4. Если клетка является столицей, про нее известен ее изначальный владелец.

### Механики обзора
Подробнее про обзор. Обзор игрока - совокупность всех клеток, которые _видны_ из клеток, принадлежащих игроку. 
У каждой клетки определены собственные значения дальности обзора и нахождения на возвышенности, зависящее от типа клетки и построек на ней.

Обозначим за `x` значение дальности обзора в некоторой клетке `[i][j]`. 

Если клетка находится на возвышенности, то из неё видны все клетки такие, что манхэттенское расстояние от изначальной клетки до них не превосходит `x`. 
Строже говоря, клетка `[i1][j1]` видна из клетки `[i][j]`, если `|i - i1| + |j - j1| <= x`. 

Если клетка *не* находится на возвышенности, то ее обзор могут блокировать клетки гор. Тогда среди клеток на обозначенном выше манхэттэнском расстоянии будут видны только такие клетки, что отрезок
с координатами начала (i + 0.5, j + 0.5) и конца (i1 + 0.5, j1 + 0.5) не пересекает никакую из клеток гор.


# Взаимодействие бота с программой

Процесс взаимодействия с ботом выглядит следующим образом:

Сначала Ваша программа считывает 4 целых числа: `height`, `width`, `players`, `1 <= player_id <= players`.
Это будут высота и ширина поля, общее количество игроков и Ваш номер как игрока. 

Далее взаимодействие происходит так: 

Ваша программа считывает число `win`. Если `win == 0`, то победитель не определен, игра продолжается. Если `win == -1`, бот побежден и более не может участвовать в игре. Иначе, `win` равен номеру победителя. 
В случае, если победитель определен, программма должна немедленно завершиться.

Если игра не закончена, Вы считываете двумерный массив клеток размера `height` * `width`. Это та часть карты, которую видит ваш бот. Каждая клетка представляет собой 5 переменных.

- `army -> integer`    - количество войск внутри клетки.

- `ownerId -> integer` - номер игрока (`1 <= номер <= players`), владеющего клеткой или `0`, если у клетки нет владельца. 

- `wall -> boolean`    - есть ли на клетке стена

- `visible -> boolean` - видна ли Вашему боту клетка.

- `originalOwner -> integer` - если клетка имеет тип `CAPITAL` или `FALLEN_CAPITAL` - номер изначального владельца столицы. Иначе - 0.

- `type -> string`     - тип клетки (`PLAIN`, `CITY`, `MOUNTAIN`, `CAPITAL`, `FALLEN_CAPITAL`). Если клетка не видна Вашему боту, то тип будет `PLAIN` для равнины и `MOUNTAIN` для всего остального.


На введенную карту вы отвечаете ходом своего бота: 

`moveType -> string` - тип хода (`MOVE`, `BUILD`, `EMPTY`)

Далее в зависимости от типа хода формат вывода различается.

* MOVE
  
  `x1, y1, x2, y2 -> integer` - начальная и конечная клетки движения. `0 <= x1, x2 < height, 0 <= y1, y2 < width`. Клетки должны являться соседними по стороне, стартовая - принадлежать Вам, а конечная - не являться горой.
  
  `amount -> integer` - кол-во войск, которое вы желаете передвинуть. Обратите внимание, что после перемещения в исходной клетке должна остаться хотя бы одна единица войск.
  
* BUILD
  
  `x1, y1, x2, y2 -> integer` - клетка, из армии которой вычтется стоимость здания и клетка, в которое здание будет построено. `0 <= x1, x2 < height, 0 <= y1, y2 < width`. Клетки должны являться соседними по стороне или совпадать и принадлежать Вам.

  `building -> string` - название здания, которое вы хотите построить. 

* EMPTY

  `None`


После вывода очередного хода программа должна повторить все вышеописанные действия, начиная со ввода числа `win`. 

# Как запустить игру. 

## Настройка игры

В этом разделе Вас интересуют два файла - `game_config.json` и `launch_options.json`. В файлах конфига можно поменять настройки игрового процесса. В файлах опций запуска нужно указать пути к ботам каждого участника игры и номер игрока. 
Формат обоих файлов можно видеть в релизной версии.

## Запуск игры и управление визуализатором.

Запуск игры производится с помощью файла `Grifaki3.exe`. Интересная информация о запуске и ходах игроков лежит в файле `runtimeLog.log`. После запуска exe-файла, перед Вам откроется консольное окно, где будет выведена информация о каждой сотом цикле ходов. 
Когда все ходы будут совершены, откроется визуализатор, где можно посмотреть запись игры, а в консольное окно для каждого игрока будет выведен его цвет. Изначально игра стоит на паузе. Нажимая клавиши A и D можно промотать запись на ход назад и вперед соответственно. Снять игру с паузы или поставить ее обратно можно нажав клавишу P.
